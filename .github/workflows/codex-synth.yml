name: Codex Synth

on:
  workflow_dispatch:   # æ‰‹å‹•ãƒœã‚¿ãƒ³
  schedule:
    - cron:  '0 0 * * 1'   # æœˆæ›œ 00:00ï¼ˆHSTï¼‰ã«å®šæœŸå®Ÿè¡Œ

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ========== 0. ã‚½ãƒ¼ã‚¹å–å¾— ==========
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0          # å¤‰æ›´å·®åˆ†ã‚’ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ã®ã§å®Œå…¨ clone

      # ========== 1. ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ==========
      - uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'pnpm'
      - run: npm i -g pnpm @openai/codex@latest

      # ========== 2. Codex ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆå®Ÿè¡Œ ==========
      - name: Run Codex (o3)
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          codex -m o3 --approval-mode full-auto \
          "Update /docs to include all current Hawaii permit PDFs \
          and refresh the timeline diagram in README.md. \
          When done, run pnpm format."

      # ========== 3. å¤‰æ›´ã‚’ push / PR ==========
      - name: Commit & push
        uses: EndBug/add-and-commit@v9
        with:
          author_name: codexâ€‘bot
          author_email: codex@example.com
          message: "chore(docs): nightly Codex refresh ğŸš€"
          push: --set-upstream origin codex/update-$(date +%Y%m%d)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}   # æ—¢å®š PAT ã§ OK 